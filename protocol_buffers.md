# Protocol Bufferとは？
- 2008年にオープンソース化されたスキーマ言語
  - スキーマ言語とは？
    - 何かしらの処理をさせるのではなく、要素や属性などの構造を定義するための言語

- なぜスキーマ言語は注目されているのか？
  - 昨今では、多くのシステムやデータが様々な技術で、複数のサービスやストレージに分割されるようになってきている。
    - モノレスからマイクロサービス化
  - クライアント側もWebだけでなく、iOSやAndroidなどのモバイル対応が必須
  - 課題
    - インターフェースを統一するのが難しい。。
  - 対応
    - 事前にどういったデータをやり取りするのかを宣言的に定義する
    - スキーマ駆動開発

- Protocol Buffersの特徴
  - gRPCのデータフォーマットとして使用されている
  - 様々な言語に変換可能
    - Java, Go, Kotlinなど
  - バイナリ形式にシリアライズされるので、サイズが小さく高速な通信が可能
  - 型安全にデータのやり取りが可能
  - JSONに変換することも可能

- JsonとProtocol Buffersの比較
  - JSON
    - Webの世界ではスタンダード
    - あらゆる言語で読むことが可能
    - 配列やネストなど、複雑な形式も扱うことができる
    - ヒューマンリーダブル(人間に読みやすい)
    - データスキーマを強制できない (型がない)
    - データサイズが大きくなりがち
  - Protocol Buffers
    - JSONと比較するとまだまだ少数派
    - 一部の言語では未対応
    - 複雑すぎる構造には不向き
    - バイナリに変換された後は、人間には読めない
    - 型が保証される
    - データサイズは小さい

- Protocol Buffersを使用した開発の進め方
  1. データスキーマを定義
  2. スキーマを元に開発言語のオブジェクトを自動生成
  3. データ通信時にバイナリにシリアライズ化して通信を行う


## messageとは
- 複数のフィールドを持つことができる型定義
  - それぞれのフィールドにはスカラ確か、コンポジット型を指定できる
- 各言語のコードとしてコンパイルした場合、構造体やクラスとして変換される
- 1つのprotoファイルに複数のmessage型を定義することも可能

## Tagとは
- Protocol Buffersではフィールドはフィールド名ではなく、タグ番号によって識別される
- タグ番号の重複は許されず、一意である必要がある
- タグの最小値は1, 最大値は2^29 - 1(536,870,911)
- ただし、19000 ~ 19999はProtocol Buffersの予約番号のため使用不可
- 1~15番までは1byteで表すことができるため、よく使うフィールドには1~15番を割り当てる
- タグは連番にする必要はないので、あまり使わないフィールドはあえて16番以降を割り当てることも可能
- タグ番号の予約をするなど、安全にProtocol Buffersを使用する方法も用意されている

## デフォルト値
- 定義したmessageでデータをやり取りする際に、定義したフィールドがセットされていない場合、そのフィールドのデフォルト値が設定される
  - string: 空の文字列
  - bytes: 空のbyte
  - bool: false
  - 整数型・浮動小数点数: 0
  - 列挙型: タグ番号0の値
  - repeated: 空のリスト